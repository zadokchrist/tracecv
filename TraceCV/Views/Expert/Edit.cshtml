@*
    For more information on enabling MVC for empty projects, visit https://go.microsoft.com/fwlink/?LinkID=397860
*@
@model Expert;
@{
}
        <h2>Update Expert Details</h2>
        @if (TempData["SuccessMessage"] != null)
        {
            <div class="alert alert-success">
                @TempData["SuccessMessage"]
            </div>
        }

        @if (TempData["ErrorMessage"] != null)
        {
            <div class="alert alert-danger">
                @TempData["ErrorMessage"]
            </div>
        }

        <form asp-action="Edit" id="createExpertForm" method="post" enctype="multipart/form-data">
            <div class="row">
                <div class="col">
                    <!-- User details -->
                    <div class="form-group">
                        <label for="Name">Name:</label>
                        <input asp-for="Name" class="form-control" required />
                    </div>
                    <div class="form-group">
                        <label for="Gender">Gender:</label>
                        <select asp-for="Gender" class="form-control" required>
                            <option selected disabled> Please Select Gender</option>
                            <option value="Male">Male</option>
                            <option value="Female">Female</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label for="DOB">Date of Birth:</label>
                        <input type="date" asp-for="DOB" class="form-control" required />
                    </div>
                    <div class="form-group">
                        <label for="Name">Nationality:</label>
                        <select asp-for="Nationality" class="form-control" id="nationalityDropdown">
                            <!-- Add an empty option for placeholder -->
                        </select>
                    </div>
                    <div class="form-group">
                        <label for="Email">Email:</label>
                        <input asp-for="Email" class="form-control" />
                    </div>
                    <!-- Contacts -->
                    <div class="form-group">
                        <div id="contactsContainer">
                            <label for="Contacts[0].PhoneNumber">Phone Number:</label>
                            <input asp-for="Contacts[0].PhoneNumber" class="form-control" />
                        </div>
                        <!-- Other contact fields... -->
                        <button type="button" id="addContact" class="btn btn-primary">Add Contact</button>
                    </div>
                    <div class="form-group">
                        <label for="experience">Years of Experience:</label>
                        <input type="number" asp-for="experience" class="form-control" required />
                    </div>
                    <div class="form-group">
                        <label for="Name">Year CV Last Edited:</label>
                        <input asp-for="lastedit" class="form-control" />
                    </div>
                    <div class="form-group">
                        <label for="WorkedWith2ML">Empployment Status:</label>
                        <div class="form-check">
                    <input type="radio" asp-for="EmploymentStatus" value="Employed" class="form-check-input" id="employed" onclick="CheckEmploymentStatus()" required />
                            <label class="form-check-label">Employed</label>
                        </div>
                        <div class="form-check">
                            <input type="radio" asp-for="EmploymentStatus" value="SelfEmployed" class="form-check-input" onclick="CheckEmploymentStatus()"  required />
                            <label class="form-check-label">Self Employed</label>
                        </div>
                    </div>
                    <div class="form-group" id="currentEmployerTextbox">
                        <label for="Name">Current Employer:</label>
                        <input asp-for="CurrentEmployer" class="form-control" />
                    </div>
                   
                    <div class="form-group">
                        <label for="Languages[0].Language">Languages:</label>
                        <div id="languagesContainer">
                            <input asp-for="Languages[0].Type" class="form-control" required />
                        </div>
                        <!-- Other contact fields... -->
                        <button type="button" id="addLanguage" class="btn btn-primary">Add Language</button>
                    </div>
                    
                    <div class="form-group">
                        <label for="WorkedWith2ML">Ever Worked With 2ML:</label>
                        <div class="form-check">
                            <input type="radio" asp-for="WorkedWith2ML" value="true" class="form-check-input" required />
                            <label class="form-check-label">Yes</label>
                        </div>
                        <div class="form-check">
                            <input type="radio" asp-for="WorkedWith2ML" value="false" class="form-check-input" required />
                            <label class="form-check-label">No</label>
                        </div>
                    </div>
                    
                </div>
                <div class="col">
                <div class="form-group">
                    <label for="Name">Category:</label>
                    <select asp-for="Category" class="form-control">
                        <option selected disabled> Please Select Category</option>
                        <option value="Trainee">Trainee</option>
                        <option value="FullTime Staff">FullTime Staff</option>
                        <option value="Short term basis associate">Short term basis associate</option>
                        <option value="Long term basis">Long term basis</option>
                    </select>
                </div>
                    
                    <div class="form-group">
                        <label for="Sector">Sector:</label>
                        <select asp-for="Sector" class="form-control">
                            <option selected disabled> Please Select Expert's Sector</option>
                            <option value="Water and Sanitation">Water and Sanitation</option>
                            <option value="Energy">Energy</option>
                            <option value="Enviroment">Enviroment</option>
                            <option value="Governance">Governance</option>
                            <option value="Technology">Tecnology</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label for="Speciality">Area of Speciality:</label>
                        <select asp-for="Speciality" class="form-control">
                            <option selected disabled>Expert's Speciality</option>
                            <option value="ICT">ICT</option>
                            <option value="Economist">Economist</option>
                            <option value="Engineering">Engineering</option>
                            <option value="Human Resource">Human Resource</option>
                            <option value="M&E">M&E</option>
                            <option value="Enviroment">Enviroment</option>
                            <option value="GIS">GIS</option>
                            <option value="Policy Regulation & legal">Policy Regulation & legal</option>
                            <option value="PPP (Public Private Partnership)">PPP (Public Private Partnership)</option>
                            <option value="Sociologist">Gender and Social Development</option>
                            <option value="Commercial">Commercial</option>
                            <option value="WASH/ Sanitation">WASH/ Sanitation</option>
                            <option value="Asset Management">Asset Management</option>
                            <option value="Financial Management">Financial Management</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label for="OtherKeyExpertise">Other Key Expertise:</label>
                        <hr class="my-3"> <!-- Add a horizontal line as a divider -->
                        <select asp-for="OtherKeyExpertises[0].Expertise" class="form-control" multiple id="otherKeyExpertiseSelect">
                            <option selected disabled>Other Key Expertise</option>
                            <option value="TrainingAndCapacityBuilding">Training and Capacity Building</option>
                            <option value="MandE">M&E</option>
                            <option value="GenderAndSocial">Gender and social sciences</option>
                            <option value="InstitutionalDevelopment">Institutional Development</option>
                            <option value="Research">Research</option>
                            <option value="Audit">Audit</option>
                            <option value="StrategicPlanning">Strategic Planning</option>
                            <option value="WaterAndSanitation">Water and sanitation</option>
                        </select>
                    </div>
                    <hr class="my-3"> <!-- Add a horizontal line as a divider -->
                    <textarea id="selectedOptionsTextarea" class="form-control" readonly></textarea>

                    <!-- Educations -->
                    <div id="educationsContainer" class="form-group">
                        <label for="Educations[0].Level">Education Level:</label>
                        <select asp-for="Educations[0].Level" class="form-control">
                            <option selected> Please Select Level of Education</option>
                            <option value="Bachelors">Bachelors</option>
                            <option value="Masters">Masters</option>
                            <option value="MBA">MBA</option>
                            <option value="Ph.D">Ph.D</option>
                        </select>
                    </div>
                    <div id="educationsContainer" class="form-group">
                        <label for="Educations[0].Level">Other Professional Certificates:</label>
                        <select asp-for="Certificates" class="form-control" multiple>
                            <option selected disabled> Please Select Level of Educatiin</option>
                            <option value="Artificial inteligence">Artificial inteligence</option>
                            <option value="CCNA">CCNA</option>
                            <option value="CISCO">CISCO</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label for="CvFile">Upload File:</label>
                        <input type="file" asp-for="CvFile" class="form-control" />

                    </div>
                </div>
            </div>
            <div class="row">
                <button type="submit" class="btn btn-success">Create</button>
            </div>
        </form>

 
    <!-- Your AJAX script here... -->
@section scripts {
    <script src="https://code.jquery.com/jquery-3.6.4.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/select2@4.1.0-rc.0/dist/js/select2.min.js"></script>
    <script>
        // Function to initialize Select2 for the nationality dropdown
        function initializeSelect2(countries) {
            $("#nationalityDropdown").select2({
                placeholder: "Search for a country",
                allowClear: true,
                minimumInputLength: 0, // Set the minimum number of characters before showing results
                data: countries.map(function (country) {
                    return {
                        id: country.name,
                        text: country.name
                    };
                })
            });
        }

        // Function to fetch countries
        function getCountries(callback) {
            $.ajax({
                url: 'https://restcountries.com/v2/all',
                type: 'GET',
                dataType: 'json',
                success: function (data) {
                    callback(data);
                },
                error: function (error) {
                    console.error('Error fetching countries:', error);
                }
            });
        }

        $(document).ready(function () {
            // Update textarea when options are selected or deselected
            $("#otherKeyExpertiseSelect").on("change", function () {
                var selectedOptions = $("#otherKeyExpertiseSelect option:selected").map(function () {
                    return $(this).text();
                }).get().join(', ');

                $("#selectedOptionsTextarea").val(selectedOptions);
            });

            // Add Contact
            $("#addLanguage").click(function () {
                var index = $("#languagesContainer input").length;

                var newLanguageHtml = `
                                            <div>
                                                <label>Language${index + 1}:</label>
                                                <input name="Languages[${index}].Type" class="form-control" />
                                                <!-- Other contact fields... -->
                                            </div>
                                        `;

                $("#languagesContainer").append(newLanguageHtml);
            });

            // Add phone contacts
            $("#addContact").click(function () {
                var index2 = $("#contactsContainer input").length;

                var newContactHtml = `
                                            <div>
                                                <label>Phone Number${index2 + 1}:</label>
                                                <input name="Contacts[${index2}].Language" class="form-control" />
                                                <!-- Other contact fields... -->
                                            </div>
                                        `;

                $("#contactsContainer").append(newContactHtml);
            });

            // Add Education
            // $("#addEducation").click(function () {
            //     var index = $("#educationsContainer input").length;

            //     var newEducationHtml = `
            //                                 <div>
            //                                     <label>Education Level:</label>
            //                                     <input name="Educations[${index}].Level" class="form-control" />
            //                                     <!-- Other education fields... -->
            //                                 </div>
            //                             `;

            //     $("#educationsContainer").append(newEducationHtml);
            // });
            // Add Education
            $("#addEducation").click(function () {
                var index = $("#educationsContainer input").length;

                var newEducationHtml = `
                                            <div>
                                                <label>Education Level:</label>
                                                <select name="Educations[${index}].Level" class="form-control">
                                                    <option selected disabled> Please Select Level of Education</option>
                                                    <option value="Bachelors">Bachelors</option>
                                                    <option value="Masters">Masters</option>
                                                    <option value="MBA">MBA</option>
                                                    <option value="Ph.D">Ph.D</option>
                                                </select>
                                                <!-- Other education fields... -->
                                            </div>
                                        `;

                $("#educationsContainer").append(newEducationHtml);
            });

            getCountries(function (countries) {
                initializeSelect2(countries);

                // Get the current nationality of the expert and set it as selected
                var currentNationality = "@Model.Nationality";
                if (currentNationality) {
                    $("#nationalityDropdown").val(currentNationality).trigger("change");
                }
            });
        });
    </script>
}
